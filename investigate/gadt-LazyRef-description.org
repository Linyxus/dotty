#+name: ino
#+begin_src elisp :cache yes
  "gadt-LazyRef"
#+end_src

#+RESULTS[96804343abd157f7459bd62023e4a1a3ef36d0b6]: ino
: gadt-LazyRef

* Preamble

  #+begin_src elisp :var ino=ino :results silent
    (write-file (concat ino "-description.org"))
  #+end_src

  #+begin_src elisp :var ino=ino :results silent
    (find-file (concat ino ".scala"))
  #+end_src

  #+begin_src elisp :var ino=ino :results silent
    (save-excursion
      (beginning-of-buffer)
      (while (re-search-forward (rx "$" "ISSUE$") nil t)
        (replace-match ino t t)))
  #+end_src

* gadt-LazyRef

#+begin_src scala :tangle gadt-LazyRef.scala
  trait FooBase {
    type Bar >: Null <: BarBase { type This <: FooBase.this.Bar }
    type This >: this.type <: FooBase { type This <: FooBase.this.This }

    def derived(bar: Bar): This = ???
  }

  trait BarBase {
    type This >: Null <: BarBase { type This <: BarBase.this.This }
  }

  object Test {
    def bad(foo: FooBase): FooBase = foo match {
      case foo: FooBase => ???
        // foo.derived(???)  // Triggers infinite loop in TypeAssigner.avoid()
    }
  }
#+end_src

#+begin_src elisp
  (sbt/run-until-output "scala3-compiler/compile")
  (setq sbt/compile-arguments "-color:never -Yno-deep-subtypes")
  (sbt/compile-file-for-output "investigate/gadt-LazyRef.scala")
#+end_src

#+RESULTS:
#+begin_example
[info] compiling 1 Scala source to /Users/linyxus/Develop/dotty/compiler/target/scala-3.0.0-RC1/classes ...
[error] -- Error: /Users/linyxus/Develop/dotty/compiler/src/dotty/tools/dotc/config/Printers.scala:22:6 
[error] 22 |      println("trying to print")
[error]    |      ^
[error]    |      Maximal number of successive inlines (32) exceeded,
[error]    |      Maybe this is caused by a recursive inline method?
[error]    |      You can use -Xmax-inlines to change the limit.
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error]    | This location contains code that was inlined from Printers.scala:22
[error] one error found
[error] one error found
[error] (scala3-compiler / Compile / compileIncremental) Compilation failed
[error] Total time: 0 s, completed May 26, 2021, 3:42:22 PM
#+end_example
